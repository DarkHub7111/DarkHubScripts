-- SERVICES B√ÅSICOS
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer

-- =====================================
-- ANTI AFK
-- =====================================
LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- =====================================
-- LOAD FLUENT (PRIMEIRO!)
-- =====================================
local Fluent = loadstring(game:HttpGet(
    "https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"
))()

local SaveManager = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"
))()

local InterfaceManager = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"
))()

-- =====================================
-- WINDOW
-- =====================================
local Window = Fluent:CreateWindow({
    Title = "Legend Hub üèáüèº",
    SubTitle = "By DarkHub",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Theme = "Aqua",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- =====================================
-- TABS
-- =====================================
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" }),
    Train = Window:AddTab({ Title = "Train", Icon = "power" }),
    Misc = Window:AddTab({ Title = "Misc", Icon = "box" }),
    Teleport = Window:AddTab({ Title = "Teleport", Icon = "map" }),
    Pet = Window:AddTab({ Title = "Pet", Icon = "paw-print" }),
    Egg = Window:AddTab({ Title = "Egg", Icon = "egg" })
}

-- Aba Event criada **depois da Egg**, mas antes da Settings
Tabs.Event = Window:AddTab({ Title = "Event", Icon = "sparkles" })

-- Agora cria a aba Settings por √∫ltimo
Tabs.Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })

-- =====================================
-- FLAGS
-- =====================================
local Flags = {
    AutoTrain = false,
    AutoWin = false,
    AutoRebirth = false,
    AutoSuper = false,
    InfMoney = false,
    Diamonds = false,
    AutoGifts = false,
    AutoCrate1 = false,
    AutoCrate2 = false,
    EggGhost = false,
    InfinitePotion = false,
    AutoEquipBestPets = false,
    AutoCraftPets = false
}
-- =====================================
-- KNIT (CARREGAMENTO SEGURO)
-- =====================================
local KnitLoaded = false
local Services = {}

task.spawn(function()
    repeat task.wait() until ReplicatedStorage:FindFirstChild("Packages")

    local ok, knit = pcall(function()
        return ReplicatedStorage.Packages
            ._Index["sleitnick_knit@1.5.1"]
            .knit.Services
    end)

    if not ok then
        warn("Knit n√£o carregou")
        return
    end

    Services = knit
    KnitLoaded = true

    Fluent:Notify({
        Title = "Knit",
        Content = "Knit carregado com sucesso!",
        Duration = 4
    })
end)

--==================================================
--==================================================
-- SERVICES
--==================================================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

--==================================================
-- TRAIN TAB (FLUENT VERSION)
--==================================================

local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Knit = ReplicatedStorage.Packages._Index["sleitnick_knit@1.5.1"].knit
local TrainRE = Knit.Services.TrainService.RE.RunTrain

--==================================================
-- FLAGS
--==================================================

local Flags = {
    TrainWorld = "1",
    TrainMachine = "1",
    AutoTrain = false
}

local AutoTrainRunning = false

--==================================================
-- UI (TRAIN TAB)
--==================================================

Tabs.Train:AddSection("Auto Train")

-- WORLD DROPDOWN
Tabs.Train:AddDropdown("TrainWorld", {
    Title = "World",
    Values = {"1","2","3","4"},
    Default = "1",
    Callback = function(value)
        Flags.TrainWorld = value
    end
})

-- MACHINE DROPDOWN
Tabs.Train:AddDropdown("TrainMachine", {
    Title = "Treadmill",
    Values = {
        "1","2","3","4","5","6",
        "7","8","9","10","11","12"
    },
    Default = "1",
    Callback = function(value)
        Flags.TrainMachine = value
    end
})

--==================================================
-- AUTO TRAIN LOOP
--==================================================

local function AutoTrainLoop()
    if AutoTrainRunning then return end
    AutoTrainRunning = true

    while Flags.AutoTrain do
        pcall(function()
            TrainRE:FireServer(
                "Treadmill_" .. Flags.TrainWorld .. "_" .. Flags.TrainMachine
            )
        end)

        -- delay seguro (principalmente World 4)
        task.wait(1)
    end

    AutoTrainRunning = false
end

-- TOGGLE
Tabs.Train:AddToggle("AutoTrainToggle", {
    Title = "Auto Train",
    Default = false,
    Callback = function(state)
        Flags.AutoTrain = state
        if state then
            AutoTrainLoop()
        end
    end
})
-- =====================================
-- AUTO WIN
-- =====================================
Tabs.Main:AddToggle("AutoWin", {
    Title = "Auto Win Contest",
    Callback = function(v)
        Flags.AutoWin = v
        task.spawn(function()
            while Flags.AutoWin do
                if KnitLoaded and Services.FightService then
                    for _, area in pairs(Workspace.Areas:GetChildren()) do
                        pcall(function()
                            Services.FightService.RE.JoinContest:FireServer(area.Name)
                            task.wait(0.1)
                            for i, gate in pairs(area.WinGates:GetChildren()) do
                                Services.FightService.RE.GetWinsEvent:FireServer(
                                    "WinGate_" .. i,
                                    gate.gate.Position
                                )
                            end
                            Services.FightService.RE.QuitContestEvent:FireServer(area.Name)
                        end)
                    end
                end
                task.wait(1)
            end
        end)
    end
})

-- =====================================
-- REBIRTHS
-- =====================================
Tabs.Main:AddToggle("AutoRebirth", {
    Title = "Auto Rebirth",
    Callback = function(v)
        Flags.AutoRebirth = v
        task.spawn(function()
            while Flags.AutoRebirth do
                if KnitLoaded and Services.RebirthService then
                    Services.RebirthService.RF.Rebirth:InvokeServer()
                end
                task.wait(0.1)
            end
        end)
    end
})

Tabs.Main:AddToggle("AutoSuper", {
    Title = "Auto Super Rebirth",
    Callback = function(v)
        Flags.AutoSuper = v
        task.spawn(function()
            while Flags.AutoSuper do
                if KnitLoaded and Services.RebirthService then
                    Services.RebirthService.RF.SuperRebirth:InvokeServer()
                end
                task.wait(0.3)
            end
        end)
    end
})

-- =====================================
-- INFINITE MONEY / POWER
-- =====================================
Tabs.Main:AddToggle("InfMoney", {
    Title = "Infinite Money",
    Callback = function(v)
        Flags.InfMoney = v
        task.spawn(function()
            while Flags.InfMoney do
                if KnitLoaded and Services.RandomPotionService then
                    Services.RandomPotionService.RE.BuyPotionEvent
                        :FireServer(-2e9, {}, true)
                end
                task.wait(0.1)
            end
        end)
    end
})

-- =====================================
-- MISC
-- =====================================
Tabs.Misc:AddToggle("Diamonds", {
    Title = "Diamonds Upgrade",
    Callback = function(v)
        Flags.Diamonds = v
        task.spawn(function()
            while Flags.Diamonds do
                if KnitLoaded and Services.RebirthService then
                    Services.RebirthService.RF.SuperRebirthUpgrade
                        :InvokeServer("Diamonds")
                end
                task.wait(1)
            end
        end)
    end
})

Tabs.Misc:AddToggle("Halloween", {
    Title = "Open Halloween GUI",
    Callback = function(v)
        local gui = LocalPlayer.PlayerGui
            :FindFirstChild("HalloweenDailyRewardGui", true)
        if gui then
            gui.Enabled = v
            gui.ResetOnSpawn = false
        end
    end
})

Tabs.Misc:AddToggle("Halloween", {
    Title = "Open Chirstmas GUI",
    Callback = function(v)
        local gui = LocalPlayer.PlayerGui
            :FindFirstChild("ChristmasDailyRewardGui", true)
        if gui then
            gui.Enabled = v
            gui.ResetOnSpawn = false
        end
    end
})

Tabs.Misc:AddToggle("AutoGifts", {
    Title = "Auto Claim Gifts",
    Callback = function(v)
        Flags.AutoGifts = v
        task.spawn(function()
            while Flags.AutoGifts do
                if KnitLoaded and Services.OnlineRewardService then
                    for i = 1, 12 do
                        Services.OnlineRewardService.RE.ClaimOnlineReward
                            :FireServer(i)
                        task.wait(0.5)
                    end
                end
                task.wait(5)
            end
        end)
    end
})

-- =====================================
-- INFINITE POTION + KING SLIME
-- =====================================
Tabs.Misc:AddToggle("InfinitePotion", {
    Title = "Infinite Potion + King Slime",
    Default = false,
    Callback = function(v)
        Flags.InfinitePotion = v

        task.spawn(function()
            while Flags.InfinitePotion do
                pcall(function()
                    game:GetService("ReplicatedStorage")
                        .Packages._Index["sleitnick_knit@1.5.1"]
                        .knit.Services.ChestService
                        .RF.ClaimDailyChest:InvokeServer()
                end)

                task.wait(0.5)
            end
        end)
    end
})

-- =====================================
-- AUTO CRATE 1
-- =====================================
Tabs.Misc:AddToggle("AutoCrate1", {
    Title = "Auto Crate 1",
    Default = false,
    Callback = function(v)
        Flags.AutoCrate1 = v

        task.spawn(function()
            while Flags.AutoCrate1 do
                pcall(function()
                    Services.ItemCrateService.RE.UnboxCrate:FireServer("Crate_1")
                end)

                task.wait(1)
            end
        end)
    end
})

-- =====================================
-- AUTO CRATE 2
-- =====================================
Tabs.Misc:AddToggle("AutoCrate2", {
    Title = "Auto Crate 2",
    Default = false,
    Callback = function(v)
        Flags.AutoCrate2 = v

        task.spawn(function()
            while Flags.AutoCrate2 do
                pcall(function()
                    Services.ItemCrateService.RE.UnboxCrate:FireServer("Crate_2")
                end)

                task.wait(1)
            end
        end)
    end
})

-- =====================================
-- AUTO CLAIM EGG GHOST
-- =====================================
Tabs.Misc:AddToggle("AutoEggBrainrot", {
    Title = "Auto Claim Egg Brainrot",
    Default = false,
    Callback = function(v)
        Flags.EggGhost = v

        task.spawn(function()
            while Flags.EggGhost do
                pcall(function()
                    Services.OnlineRewardService
                        .RF.ClaimOnlineQuestReward
                        :InvokeServer()
                end)

                task.wait(5)
            end
        end)
    end
})

-- =====================================
-- TELEPORT
-- =====================================

Tabs.Teleport:AddParagraph({
    Title = "Info",
    Content = "click in button and rejoin"
})

for i = 2, 4 do
    Tabs.Teleport:AddButton({
        Title = "World " .. i,
        Callback = function()
            if KnitLoaded and Services.AreaService then
                Services.AreaService.RE.UpdatePlayerCurrentArea
                    :FireServer("Area_" .. i)
            end
        end
    })
end

-- Novo bot√£o: Area Fruit
Tabs.Teleport:AddButton({
    Title = "Area Fruit",
    Callback = function()
        if KnitLoaded and Services.AreaService then
            Services.AreaService.RE.UpdatePlayerCurrentArea
                :FireServer("Area_Fruit")
        end
    end
})

-- =====================================
-- PET
-- =====================================
Tabs.Pet:AddToggle("AutoEquipBestPets", {
    Title = "Auto Equip Best Pets",
    Default = false,
    Callback = function(v)
        Flags.AutoEquipBestPets = v

        task.spawn(function()
            while Flags.AutoEquipBestPets do
                if KnitLoaded and Services.PetService then
                    pcall(function()
                        Services.PetService.RE.EquipBestPets:FireServer()
                    end)
                end

                task.wait(2) -- delay seguro
            end
        end)
    end
})

Tabs.Pet:AddToggle("AutoCraftPets", {
    Title = "Auto Craft Pets",
    Default = false,
    Callback = function(v)
        Flags.AutoCraftPets = v

        task.spawn(function()
            while Flags.AutoCraftPets do
                if KnitLoaded and Services.PetService then
                    pcall(function()
                        Services.PetService.RE.EnlargeAllPets:FireServer()
                    end)
                end

                task.wait(3) -- delay seguro
            end
        end)
    end
})

-- =====================================
-- EGG TAB (FUNCIONAL)
-- =====================================
local EggTab = Tabs.Egg

Flags.EggToggles = {}

-- Fun√ß√£o para criar toggle e auto hatch
local function CreateEggToggle(world, egg)
    local eggName = "Egg_" .. world .. "_" .. egg
    Flags.EggToggles[eggName] = false

    EggTab:AddToggle(eggName, {
        Title = "World " .. world .. " - Egg " .. egg,
        Default = false,
        Callback = function(v)
            Flags.EggToggles[eggName] = v

            task.spawn(function()
                while Flags.EggToggles[eggName] do
                    pcall(function()
                        local args = {eggName, 1}

                        game:GetService("ReplicatedStorage")
                            :WaitForChild("Packages")
                            :WaitForChild("_Index")
                            :WaitForChild("sleitnick_knit@1.5.1")
                            :WaitForChild("knit")
                            :WaitForChild("Services")
                            :WaitForChild("EggHatchService")
                            :WaitForChild("RE")
                            :WaitForChild("Hatch")
                            :FireServer(unpack(args))
                    end)
                    task.wait(1) -- delay entre hatches
                end
            end)
        end
    })
end

-- Cria toggles para todos os ovos (4 mundos x 4 ovos)
for world = 1, 4 do
    for egg = 1, 4 do
        CreateEggToggle(world, egg)
    end
end

-- =====================================
-- ABA EVENT
-- =====================================
-- Fun√ß√£o gen√©rica pra comprar fruit
local function BuyFruit(fruitID)
    if not KnitLoaded then return end
    local success, err = pcall(function()
        local args = {fruitID}
        local fruitRE = ReplicatedStorage:WaitForChild("Packages")
            :WaitForChild("_Index")
            :WaitForChild("sleitnick_knit@1.5.1")
            :WaitForChild("knit")
            :WaitForChild("Services")
            :WaitForChild("FruitService")
            :WaitForChild("RE")
            :WaitForChild("BuyFruit")
        fruitRE:FireServer(unpack(args))
    end)
    if not success then
        warn("Erro ao comprar fruit "..fruitID..": "..tostring(err))
    end
end

-- Flags para ativar/desativar
Flags.FruitToggles = {}

for i=1,4 do
    local fruitID = string.format("Fruit_00%d",i)
    Flags.FruitToggles[fruitID] = false

    Tabs.Event:AddToggle(fruitID,{
        Title="Auto "..fruitID,
        Callback=function(v)
            Flags.FruitToggles[fruitID] = v
            task.spawn(function()
                while Flags.FruitToggles[fruitID] do
                    BuyFruit(fruitID)
                    task.wait(1) -- delay seguro entre compras
                end
            end)
        end
    })
end

-- =====================================
-- ABA EVENT - FARM CANDY/GIFT (4 WinGates)
-- =====================================
Flags.FarmCandy = false

Tabs.Event:AddToggle("FarmCandy", {
    Title = "Farm Candy/Gift",
    Callback = function(v)
        Flags.FarmCandy = v
        task.spawn(function()
            while Flags.FarmCandy do
                if KnitLoaded and Services.FightService then
                    local success, remote = pcall(function()
                        return Services.FightService:FindFirstChild("RE"):FindFirstChild("GetWinsEvent")
                    end)

                    if success and remote then
                        pcall(function()
                            -- WinGate 16
                            remote:FireServer(unpack({
                                "WinGate_16",
                                Vector3.new(1813, 780.8884, -689396.3125)
                            }))
                            -- WinGate 12
                            remote:FireServer(unpack({
                                "WinGate_12",
                                Vector3.new(1813, 780.9491, -229395.1406)
                            }))
                            -- WinGate 14
                            remote:FireServer(unpack({
                                "WinGate_14",
                                Vector3.new(1812, 780.8914, -373397.5)
                            }))
                            -- WinGate 13
                            remote:FireServer(unpack({
                                "WinGate_13",
                                Vector3.new(1815, 780.9649, -289395.25)
                            }))
                        end)
                    end
                end
                task.wait(0.5) -- delay seguro entre cada loop
            end
        end)
    end
})

-- =====================================
-- ABA MAIN - AUTO WIN (WinGates m√∫ltiplos)
-- =====================================
Flags.AutoWin = false

Tabs.Main:AddToggle("AutoWin", {
    Title = "Auto Win",
    Callback = function(v)
        Flags.AutoWin = v
        task.spawn(function()
            while Flags.AutoWin do
                if KnitLoaded and Services.FightService then
                    local success, remote = pcall(function()
                        return Services.FightService:FindFirstChild("RE"):FindFirstChild("GetWinsEvent")
                    end)

                    if success and remote then
                        pcall(function()
                            -- WinGate 16
                            remote:FireServer(unpack({
                                "WinGate_16",
                                Vector3.new(1813, 780.8884, -689396.3125)
                            }))
                            -- WinGate 12
                            remote:FireServer(unpack({
                                "WinGate_12",
                                Vector3.new(1813, 780.9491, -229395.1406)
                            }))
                            -- WinGate 14
                            remote:FireServer(unpack({
                                "WinGate_14",
                                Vector3.new(1812, 780.8914, -373397.5)
                            }))
                            -- WinGate 13
                            remote:FireServer(unpack({
                                "WinGate_13",
                                Vector3.new(1815, 780.9649, -289395.25)
                            }))
                        end)
                    end
                end
                task.wait(0.5) -- delay seguro
            end
        end)
    end
})

-- =====================================
-- ABA EVENT - EGG CHRISTMAS
-- =====================================
Flags.EggChristmas = false

Tabs.Event:AddToggle("EggChristmas", {
    Title = "Egg_Christmas",
    Callback = function(v)
        Flags.EggChristmas = v
        task.spawn(function()
            while Flags.EggChristmas do
                if KnitLoaded and Services.EggHatchService then
                    local success, remote = pcall(function()
                        return Services.EggHatchService:FindFirstChild("RE"):FindFirstChild("Hatch")
                    end)

                    if success and remote then
                        pcall(function()
                            local args = {"Egg_Christmas", 3}
                            remote:FireServer(unpack(args))
                        end)
                    end
                end
                task.wait(1) -- delay entre cada hatch
            end
        end)
    end
})

-- =====================================
-- MISC | AUTO RANDOM POTION
-- =====================================
Flags.AutoRandomPotion = false

Tabs.Misc:AddToggle("AutoRandomPotion", {
    Title = "Auto Random Potion",
    Default = false
}):OnChanged(function(v)
    Flags.AutoRandomPotion = v

    task.spawn(function()
        while Flags.AutoRandomPotion do
            if KnitLoaded and Services.RandomPotionService then
                pcall(function()
                    Services.RandomPotionService.RE.BuyPotionEvent
                        :FireServer(3)
                end)
            end
            task.wait(0.5) -- delay seguro
        end
    end)
end)

-- =====================================
-- MISC | AUTO USE POTION
-- =====================================
Flags.AutoUsePotion = false

Tabs.Misc:AddToggle("AutoUsePotion", {
    Title = "Auto Use Potion (Double Strength)",
    Default = false
}):OnChanged(function(v)
    Flags.AutoUsePotion = v

    task.spawn(function()
        while Flags.AutoUsePotion do
            if KnitLoaded and Services.PotionService then
                pcall(function()
                    Services.PotionService.RE.UsePotion
                        :FireServer("Potion_DoubleStrength")
                end)
            end
            task.wait(1) -- delay maior pra evitar spam
        end
    end)
end)

-- =====================================
-- BUTTON FLOATING 

local screenGui = Instance.new("ScreenGui")
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
local imageButton = Instance.new("ImageButton")
imageButton.Size = UDim2.new(0, 50, 0, 50)  -- Set size to 100x100 pixels
imageButton.Position = UDim2.new(1, -110, 0, 10)  -- Set position
imageButton.BackgroundTransparency = 1  -- Make the background transparent
imageButton.Image = "rbxassetid://2875276601"  -- Your image ID
imageButton.Parent = screenGui
local uiStroke = Instance.new("UIStroke")
uiStroke.Parent = imageButton
uiStroke.Thickness = 4  -- Adjust the thickness of the border
uiStroke.Color = Color3.fromRGB(0, 0, 255) -- Pure blue
uiStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
uiStroke.Transparency = 0
    
    local corner = Instance.new("UICorner")
    corner.Parent = imageButton
    
    imageButton.MouseButton1Click:Connect(function()
        if WindowHidden == false then
            Window:Minimize()
            WindowHidden = true
        else
Window:Minimize()
            WindowHidden = false
        end
    end)
    
    local dragging = false
    local dragInput
    local startPos
    local startSize
    
    imageButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            startPos = input.Position
            startSize = imageButton.Position
    
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    imageButton.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
            local delta = input.Position - startPos
            imageButton.Position = UDim2.new(startSize.X.Scale, startSize.X.Offset + delta.X, startSize.Y.Scale, startSize.Y.Offset + delta.Y)
        end
    end)
    
-- =====================================
-- SAVE MANAGER
-- =====================================
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)

InterfaceManager:SetFolder("HorseRaceHub")
SaveManager:SetFolder("HorseRaceHub/saves")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)

-- =====================================
-- FINAL
-- =====================================
Fluent:Notify({
    Title = "Legend Hub",
    Content = "UI carregada com sucesso!",
    Duration = 6
})

SaveManager:LoadAutoloadConfig()
